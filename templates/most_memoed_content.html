{% extends 'main.html' %}
{% load static %}
{% load i18n %}
{% block main_content %}

<div class="grid grid-cols-12 gap-x-4">
    <!-- Start Bread Crumb Section -->
    <div class="col-span-full card flex-center-btween">
        <h5 class="card-title">{% trans "Most Memoed Content" %}</h5>
        <ul class="flex items-center flex-wrap gap-1.5 *:flex-center *:gap-1.5 leading-none text-gray-900 dark:text-dark-text mt-2">
            <li class="text-primary-500 after:font-remix after:flex-center after:font-thin after:text-gray-900 after:size-5 after:content-['\ea6d'] after:translate-y-[1.4px] last:after:hidden [&amp;.current-page]:text-gray-500 dark:[&amp;.current-page]:text-dark-text-two">
                <a href="{% url 'index' %}">{% trans "Home" %}</a>
            </li>
            <li class="text-primary-500 after:font-remix after:flex-center after:font-thin after:text-gray-900 after:size-5 after:content-['\ea6d'] after:translate-y-[1.4px] last:after:hidden [&amp;.current-page]:text-gray-500 dark:[&amp;.current-page]:text-dark-text-two current-page">
                <a href="#">{% trans "Most Memoed Content" %}</a>
            </li>
        </ul>
    </div>
    <!-- End Bread Crumb Section -->

    <!-- Start Most Memoed Content Section -->
    <div class="col-span-full card">
        <div class="flex flex-col gap-2 sm:flex-center-between sm:flex-row px-4 py-5 sm:p-7 bg-gray-200/30 dark:bg-dark-card-shade">
            <div>
                <h6 class="card-title">{% trans "Most Memoed Content" %}</h6>
                <p class="card-description">{% trans "Search and view contents by memo frequency" %}</p>
            </div>
            <!-- Search Form -->
            <form method="GET" class="flex items-center gap-2">
                <input
                    type="text"
                    name="search"
                    placeholder="{% trans 'Search by content name...' %}"
                    value="{{ search_term }}"
                    class="form-input"
                />
                <button type="submit" class="btn b-solid btn-primary-solid">
                    {% trans "Search" %}
                </button>
            </form>
        </div>

        <!-- Content Table -->
        <div class="overflow-x-auto scrollbar-table">
            <table class="table-auto w-full whitespace-nowrap text-left text-xs text-gray-500 dark:text-dark-text font-semibold leading-none">
                <thead class="border-b border-dashed border-gray-900/40 dark:border-dark-border-three">
                    <tr>
                        <th class="px-3.5 py-4">{% trans "Content Name" %}</th>
                        <th class="px-3.5 py-4">{% trans "# of Memos" %}</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-dashed divide-gray-900/40 dark:divide-dark-border-three">
                    {% if most_memo_contents %}
                    {% for content in most_memo_contents %}
                    <tr>
                        <td class="flex items-center gap-2 px-3.5 py-2">
                            <a href="#" class="size-10 rounded-50 overflow-hidden dk-theme-card-square">
                                <img src="{% static 'images/admin/top-course/top-course-1.png' %}" alt="thumb">
                            </a>
                            <div>
                                <h6 class="text-heading font-semibold mb-1.5 line-clamp-1">
                                    <a href="{{content.object_id}}" target="_blank">{{content.contents_name}}</a>
                                </h6>
                            </div>
                        </td>
                        <td class="px-3.5 py-4">{{content.total_memos}}</td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="2" class="px-3.5 py-4 text-center">{% trans "No memoed content found" %}</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {% if is_paginated %}
        <div class="flex justify-center items-center mt-6">
            <nav class="pagination-nav">
                <ul class="flex items-center space-x-2">
                    {% if page_obj.has_previous %}
                        <li>
                            <a href="?page={{ page_obj.previous_page_number }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">
                                <span class="sr-only">{% trans "Previous" %}</span>
                                <i class="fas fa-angle-left">&lt;</i>
                            </a>
                        </li>
                    {% else %}
                        <li>
                            <span class="flex items-center justify-center w-10 h-10 text-gray-400 bg-white rounded-md cursor-not-allowed dark:bg-dark-card-two dark:text-gray-600">
                                <i class="fas fa-angle-left">&lt;</i>
                            </span>
                        </li>
                    {% endif %}

                    {% if page_obj.paginator.num_pages < 10 %}
                        <!-- Show all pages if total pages < 10 -->
                        {% for num in page_obj.paginator.page_range %}
                            <li>
                                {% if num == page_obj.number %}
                                    <span class="flex items-center justify-center w-10 h-10 text-white bg-primary-500 rounded-md">{{ num }}</span>
                                {% else %}
                                    <a href="?page={{ num }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">{{ num }}</a>
                                {% endif %}
                            </li>
                        {% endfor %}
                    {% else %}
                        <!-- Show first 2 pages, ellipsis, and last 2 pages -->

                        <!-- First 2 pages -->
                        {% for num in "12"|make_list %}
                            {% with num=num|add:"0" %}
                            <li>
                                {% if num|add:0 == page_obj.number %}
                                    <span class="flex items-center justify-center w-10 h-10 text-white bg-primary-500 rounded-md">{{ num }}</span>
                                {% else %}
                                    <a href="?page={{ num }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">{{ num }}</a>
                                {% endif %}
                            </li>
                            {% endwith %}
                        {% endfor %}

                        <!-- Current page if not in first 2 or last 2 -->
                        {% if page_obj.number > 2 and page_obj.number < page_obj.paginator.num_pages|add:"-1" %}
                            <!-- Ellipsis before current if not right after first 2 -->
                            {% if page_obj.number > 3 %}
                                <li>
                                    <span class="flex items-center justify-center w-10 h-10 text-gray-600">...</span>
                                </li>
                            {% endif %}

                            <!-- Current page -->
                            <li>
                                <span class="flex items-center justify-center w-10 h-10 text-white bg-primary-500 rounded-md">{{ page_obj.number }}</span>
                            </li>

                            <!-- Ellipsis after current if not right before last 2 -->
                            {% if page_obj.number < page_obj.paginator.num_pages|add:"-2" %}
                                <li>
                                    <span class="flex items-center justify-center w-10 h-10 text-gray-600">...</span>
                                </li>
                            {% endif %}
                        {% else %}
                            <!-- Just show ellipsis between first 2 and last 2 -->
                            <li>
                                <span class="flex items-center justify-center w-10 h-10 text-gray-600">...</span>
                            </li>
                        {% endif %}

                        <!-- Last 2 pages -->
                        {% with second_last=page_obj.paginator.num_pages|add:"-1" %}
                            {% for num in "12"|make_list %}
                                {% if forloop.first %}
                                    <!-- Second to last page -->
                                    <li>
                                        {% if second_last == page_obj.number %}
                                            <span class="flex items-center justify-center w-10 h-10 text-white bg-primary-500 rounded-md">{{ second_last }}</span>
                                        {% else %}
                                            <a href="?page={{ second_last }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">{{ second_last }}</a>
                                        {% endif %}
                                    </li>
                                {% else %}
                                    <!-- Last page -->
                                    <li>
                                        {% if page_obj.paginator.num_pages == page_obj.number %}
                                            <span class="flex items-center justify-center w-10 h-10 text-white bg-primary-500 rounded-md">{{ page_obj.paginator.num_pages }}</span>
                                        {% else %}
                                            <a href="?page={{ page_obj.paginator.num_pages }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">{{ page_obj.paginator.num_pages }}</a>
                                        {% endif %}
                                    </li>
                                {% endif %}
                            {% endfor %}
                        {% endwith %}
                    {% endif %}

                    {% if page_obj.has_next %}
                        <li>
                            <a href="?page={{ page_obj.next_page_number }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">
                                <span class="sr-only">{% trans "Next" %}</span>
                                <i class="fas fa-angle-right">&gt;</i>
                            </a>
                        </li>
                    {% else %}
                        <li>
                            <span class="flex items-center justify-center w-10 h-10 text-gray-400 bg-white rounded-md cursor-not-allowed dark:bg-dark-card-two dark:text-gray-600">
                                <i class="fas fa-angle-right">&gt;</i>
                            </span>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
        {% endif %}
        <!-- End Pagination -->
    </div>
    <!-- End Most Memoed Content Section -->
</div>

{% endblock %}