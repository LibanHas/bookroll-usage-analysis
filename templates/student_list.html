{% extends 'main.html' %}
{% load static %}
{% load i18n %}
{% block main_content %}

<div class="card p-0 lg:min-h-[calc(100vh_-_theme('spacing.header')_*_1.4)] xl:min-h-[calc(100vh_-_theme('spacing.header')_*_1.6)]">
    <div class="flex flex-col gap-2 sm:flex-center-between sm:flex-row px-4 py-5 sm:p-7 bg-gray-200/30 dark:bg-dark-card-shade">
        <div>
            <h6 class="card-title">{% trans "Students list" %}</h6>
            <p class="card-description">{% trans "All Students Here" %}</p>
        </div>
        <!-- Search Form -->
        <form method="GET" class="flex items-center gap-2">
            <input
                type="text"
                name="search"
                placeholder="{% trans 'Search...' %}"
                value="{{ search_term }}"
                class="form-input"
            />
            <button type="submit" class="btn b-solid btn-primary-solid">
                {% trans "Search" %}
            </button>
        </form>
    </div>

    <!-- Start Students List Table -->
    <div class="p-3 sm:p-4">
        <div class="overflow-x-auto scrollbar-table">

            {% if results.students and results.students|length > 0 %}
                <table class="table-auto border-collapse w-full whitespace-nowrap text-left text-gray-500 dark:text-dark-text font-medium">
                    <thead>
                        <tr class="text-primary-500">
                            <th class="px-4 py-4 bg-[#F2F4F9] dark:bg-dark-card-two dk-theme-card-square">{% trans "Name" %}</th>
                            <th class="px-4 py-4 bg-[#F2F4F9] dark:bg-dark-card-two dk-theme-card-square">{% trans "Email" %}</th>
                            <th class="px-4 py-4 bg-[#F2F4F9] dark:bg-dark-card-two dk-theme-card-square">{% trans "Active Courses" %}</th>
                            <th class="px-4 py-4 bg-[#F2F4F9] dark:bg-dark-card-two dk-theme-card-square">{% trans "Archived Courses" %}</th>
                            <th class="px-4 py-4 bg-[#F2F4F9] dark:bg-dark-card-two dk-theme-card-square">{% trans "Total Courses" %}</th>
                            <th class="px-4 py-4 bg-[#F2F4F9] dark:bg-dark-card-two dk-theme-card-square">{% trans "Status" %}</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-dark-border">
                        {% for student in results.students %}
                        <tr>
                            <!-- Name -->
                            <td class="px-4 py-4">
                                <div class="flex items-center gap-3.5">
                                    <a href="#" class="size-12 rounded-50 overflow-hidden dk-theme-card-square">
                                        <img src="{% static 'images/user/profile-img.png' %}" alt="student-photo">
                                    </a>
                                    <div>
                                        <a href="{% url 'student_detail' student.user_id %}">
                                            <h6 class="leading-none text-heading font-semibold">
                                                {{ student.firstname }} {{ student.lastname }}
                                            </h6>
                                        </a>
                                    </div>
                                </div>
                            </td>

                            <!-- Email -->
                            <td class="px-4 py-4">
                                {{ student.email }}
                            </td>

                            <!-- Active Courses (placeholder) -->
                            <td class="px-4 py-4">
                                {{ student.active_coruses | default:"0" }}
                            </td>

                            <!-- Archived Courses (placeholder) -->
                            <td class="px-4 py-4">
                                {{ student.archived_courses | default:"0" }}
                            </td>

                            <!-- Total Courses (placeholder) -->
                            <td class="px-4 py-4">
                                {{ student.total_courses | default:"1" }}
                            </td>

                            <!-- Online/Offline Status -->
                            <td class="px-4 py-4">
                                {% if student.is_online %}
                                    <span class="badge badge-success-outline">{% trans "Online" %}</span>
                                {% else %}
                                    <span class="badge badge-disable-outline">{% trans "Offline" %}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <!-- Pagination -->
                {% if is_paginated %}
                <div class="flex justify-center items-center mt-6">
                    <nav class="pagination-nav">
                        <ul class="flex items-center space-x-2">
                            {% if page_obj.has_previous %}
                                <li>
                                    <a href="?page={{ page_obj.previous_page_number }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">
                                        <span class="sr-only">{% trans "Previous" %}</span>
                                        <i class="fas fa-angle-left">&lt;</i>
                                    </a>
                                </li>
                            {% else %}
                                <li>
                                    <span class="flex items-center justify-center w-10 h-10 text-gray-400 bg-white rounded-md cursor-not-allowed dark:bg-dark-card-two dark:text-gray-600">
                                        <i class="fas fa-angle-left">&lt;</i>
                                    </span>
                                </li>
                            {% endif %}

                            {% if page_obj.paginator.num_pages < 10 %}
                                <!-- Show all pages if total pages < 10 -->
                                {% for num in page_obj.paginator.page_range %}
                                    <li>
                                        {% if num == page_obj.number %}
                                            <span class="flex items-center justify-center w-10 h-10 text-white bg-primary-500 rounded-md">{{ num }}</span>
                                        {% else %}
                                            <a href="?page={{ num }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">{{ num }}</a>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            {% else %}
                                <!-- Show first 2 pages, ellipsis, and last 2 pages -->

                                <!-- First 2 pages -->
                                {% for num in "12"|make_list %}
                                    {% with num=num|add:"0" %}
                                    <li>
                                        {% if num|add:0 == page_obj.number %}
                                            <span class="flex items-center justify-center w-10 h-10 text-white bg-primary-500 rounded-md">{{ num }}</span>
                                        {% else %}
                                            <a href="?page={{ num }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">{{ num }}</a>
                                        {% endif %}
                                    </li>
                                    {% endwith %}
                                {% endfor %}

                                <!-- Current page if not in first 2 or last 2 -->
                                {% if page_obj.number > 2 and page_obj.number < page_obj.paginator.num_pages|add:"-1" %}
                                    <!-- Ellipsis before current if not right after first 2 -->
                                    {% if page_obj.number > 3 %}
                                        <li>
                                            <span class="flex items-center justify-center w-10 h-10 text-gray-600">...</span>
                                        </li>
                                    {% endif %}

                                    <!-- Current page -->
                                    <li>
                                        <span class="flex items-center justify-center w-10 h-10 text-white bg-primary-500 rounded-md">{{ page_obj.number }}</span>
                                    </li>

                                    <!-- Ellipsis after current if not right before last 2 -->
                                    {% if page_obj.number < page_obj.paginator.num_pages|add:"-2" %}
                                        <li>
                                            <span class="flex items-center justify-center w-10 h-10 text-gray-600">...</span>
                                        </li>
                                    {% endif %}
                                {% else %}
                                    <!-- Just show ellipsis between first 2 and last 2 -->
                                    <li>
                                        <span class="flex items-center justify-center w-10 h-10 text-gray-600">...</span>
                                    </li>
                                {% endif %}

                                <!-- Last 2 pages -->
                                {% with second_last=page_obj.paginator.num_pages|add:"-1" %}
                                    {% for num in "12"|make_list %}
                                        {% if forloop.first %}
                                            <!-- Second to last page -->
                                            <li>
                                                {% if second_last == page_obj.number %}
                                                    <span class="flex items-center justify-center w-10 h-10 text-white bg-primary-500 rounded-md">{{ second_last }}</span>
                                                {% else %}
                                                    <a href="?page={{ second_last }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">{{ second_last }}</a>
                                                {% endif %}
                                            </li>
                                        {% else %}
                                            <!-- Last page -->
                                            <li>
                                                {% if page_obj.paginator.num_pages == page_obj.number %}
                                                    <span class="flex items-center justify-center w-10 h-10 text-white bg-primary-500 rounded-md">{{ page_obj.paginator.num_pages }}</span>
                                                {% else %}
                                                    <a href="?page={{ page_obj.paginator.num_pages }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">{{ page_obj.paginator.num_pages }}</a>
                                                {% endif %}
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                {% endwith %}
                            {% endif %}

                            {% if page_obj.has_next %}
                                <li>
                                    <a href="?page={{ page_obj.next_page_number }}{% if search_term %}&search={{ search_term }}{% endif %}" class="flex items-center justify-center w-10 h-10 text-gray-600 bg-white rounded-md hover:bg-primary-100 hover:text-primary-600 dark:bg-dark-card-two dark:text-dark-text dark:hover:bg-primary-900 dark:hover:text-primary-400">
                                        <span class="sr-only">{% trans "Next" %}</span>
                                        <i class="fas fa-angle-right">&gt;</i>
                                    </a>
                                </li>
                            {% else %}
                                <li>
                                    <span class="flex items-center justify-center w-10 h-10 text-gray-400 bg-white rounded-md cursor-not-allowed dark:bg-dark-card-two dark:text-gray-600">
                                        <i class="fas fa-angle-right">&gt;</i>
                                    </span>
                                </li>
                            {% endif %}
                        </ul>
                    </nav>
                </div>
                {% endif %}
                <!-- End Pagination -->

            {% else %}
                <p class="text-center py-4">{% trans "No students found" %}</p>
            {% endif %}

        </div>
    </div>
    <!-- End Students List Table -->
</div>





{% endblock %}
